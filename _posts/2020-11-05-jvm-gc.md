---
title:  "[Java] JVM과 GC 메모리 관리"
date: 2020-11-05
categories: ['Java']
tags: ['JVM','GC']
---

- JVM(Java Virtual Machine, 자바가상머신) <br>
 OS의 메모리 영역에 접근하여 메모리를 관리하는 프로그램으로, 메모리관리와 Garbage Collecting 기능을 수행한다. 
- GC(Garbage Collector, 가비지 컬렉터) <br>
 동적으로 할당한 메모리 영역 중 사용하지 않는 영역을 탐지하여 해제하는 기능을 수행한다. 

<br>

## JVM의 메모리관리
(참고) https://yaboong.github.io/java/2018/06/09/java-garbage-collection/

  C나 C++에서는 OS레벨의 메모리에 직접 접근하기 때문에, free() 메소드를 호출하여 할당받은 메모리를 해제해주어야 한다. 그렇지 않으면 메모리 누수가 발생하여 프로그램의 응답속도가 늦어지다 결국 OOM(OutOfMemory) 오류로 프로그램이 종료되고, 다른 프로그램에 영향을 끼칠 수도 있다. 

  반면, 자바는 OS의 메모리 영역에 직접 접근하지 않고, JVM이라는 가상머신을 통해 간접적으로 접근한다. JVM은 C로 쓰여진 프로그램으로, 오브젝트가 필요해지지 않는 시점에서 알아서 free()를 수행하여 메모리를 확보한다. 

  프로그램 실행시 JVM 옵션을 주어서 OS에 요청한 사이즈 만큼의 메모리를 할당 받아 실행하게 된다. 할당받은 메모리 이상을 사용하게 되면, 에러가 나면서 자동적으로 프로그램이 종료된다. 그러므로 현재 프로세스에서 메모리 누수가 발생하더라도 현재 실행중인 프로그램만 죽고, 다른 프로그램에는 영향을 끼치지 않는다. 

  이렇게 자바는 가상머신을 사용함으로써 OS레벨에서의 memory leak이 불가능하게 된다는 장점이 있다. 


## Garbage Collecting 과정

 Heap영역에서 더 이상 사용되지 않는 오브젝트를 찾아, 가비지 컬렉션을 담당하는 프로세스가 자동으로 메모리에서 제거한다.

> stack과 heap

- Stack : 정적으로 할당한 메모리 영역
   - 원시 타입의 데이터가 값과 함께 할당된다. 
   - Heap영역에 생성된 오브젝트 타입 데이터의 참조값이 할당된다. 
- Heap : 동적으로 할당한 메모리 영역
   - 모든 오브젝트 타입의 데이터가 할당된다.

> runtime시 stack과 heap에 메모리 할당<br>

![image](https://user-images.githubusercontent.com/62331803/98260792-110dc480-1fc7-11eb-8b46-eb28dae2cd66.png)

- 원시 타입의 데이터의 경우 변수와 값이 모두 stack에 저장
- 오브젝트타입인 string형 데이터는 변수(참조값)는 stack에 값(실제값)은 heap에 저장

> 사용 종료시<br>

<img src="https://user-images.githubusercontent.com/62331803/98261438-d2c4d500-1fc7-11eb-899e-a89d6c317a97.png" width="70%">

- 실행이 종료되면 stack에 할당되었던 데이터는 삭제
- 하지만, heap 영역에 할당된 데이터는 삭제되지 않고 남아있고, 이것을 Unreachable Object라고 부름

> gc 처리과정

1. Garbage collector가 stack의 모든 변수를 스캔하며, 각각 어떤 객체를 참조하고 있는지 찾아 마킹한다. 







> 참고자료
- https://youtu.be/vZRmCbl871I
- https://118k.tistory.com/608
- https://asfirstalways.tistory.com/158
- https://yaboong.github.io/java/2018/06/09/java-garbage-collection/